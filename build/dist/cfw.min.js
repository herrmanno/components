!function(){!function(){window.Promise=function e(t,n){var r=this;this.data=void 0,this.resolved=!1,this.rejected=!1,this.done=!1,"function"==typeof t&&(this.onResolve=t),"function"==typeof n&&(this.onReject=n),"string"==typeof t&&(this.name=t),this.ret=void 0,this.set=function(e){if(r.done)throw"Promise is already resolved / rejected";r.data=e},this.resolve=function(e){r.set(e),r.resolved=r.done=!0,r.onResolve&&r._resolve()},this._resolve=function(){r.ret||(r.ret=new e("Return-Promise"+r.name));var t=r.onResolve(r.data);t&&t instanceof e?t.then(r.ret.resolve,r.ret.reject):r.ret.resolve(t)},this.reject=function(e){r.set(e),r.rejected=r.done=!0,r.onReject&&r.onReject(this.data),r.ret&&r.ret.reject(this.data)},this._reject=function(){r.ret||(r.ret=new e("Return-Promise"+r.name)),r.onReject(r.data),r.ret.reject(r.data)},this.then=function(t,n){return r.ret=new e("Return-Promise"+r.name),t&&"function"==typeof t&&(r.onResolve=t),n&&"function"==typeof n&&(r.onReject=n),r.resolved&&r._resolve(),r.rejected&&r._reject(),r.ret},this["catch"]=function(e){r.onReject=e,r.rejected&&r._reject()}},window.Promise.all=function(e){var t=new Promise,n=[];return 0===e.length?t.resolve():e.forEach(function(r,o){r.then(function(r){if(!t.done){n[o]=r;var i=e.reduce(function(e,t){return e&&t.resolved},!0);i&&t.resolve(n)}})["catch"](function(e){t.reject(e)})}),t}}(),CFWRenderer=function Renderer(){function parse(e,t){t=t||{html:null,parent:null,children:[]};for(var n;null!==(n=r.tag.exec(e));){var o,i,s,h,l,c;if(0!==n.index?(o=e.match(r.text)[0],o=o.substr(0,o.length-1),i="TEXT",h=!0,l=!1):(o=n[1].trim(),i=(o+">").match(r.type)[1],s="/"===o[0],h="/"===o[o.length-1],l=!!o.match(r.repeat),h&&CFW.hasComponent(i)&&(h=!1,o=o.substr(0,o.length-1)+" ",c=!0)),e=e.slice(o.length+("TEXT"===i?0:2)),s)break;if(t.children.push({parent:t,html:o,type:i,selfClosing:h,repeat:l,children:[]}),!c&&!h){var a=parse(e,t.children[t.children.length-1]);e=a.html,t.children.pop(),t.children.push(a.root)}n=e.match(r.tag)}return{html:e,root:t}}function renderRepeat(e,t){t=[].concat(t);for(var n=0;n<e.children.length;n++){var o=e.children[n];if(o.repeat){var i,s=/repeat=["|']\s*(\S+)\s+as\s+(\S+?)["|']/,h=o.html.match(s).slice(1),l=h[1];if(l.indexOf(",")>-1){var c=l.split(",");l=c[0].trim(),i=c[1].trim()}var a=evaluate(t,h[0]),m=[];a.forEach(function(e,n){var s={};s[l]=e,s[i]=n;var h=[].concat(t);h.unshift(s);var c=copyNode(o);c.repeat=!1,c.html=c.html.replace(r.repeat,""),c.html=repl(c.html,h),c=renderRepeat(c,h),m.push(c)}),m.forEach(function(t){e.children.splice(e.children.indexOf(o),0,t)}),e.children.splice(e.children.indexOf(o),1)}else o.html=repl(o.html,t),o=renderRepeat(o,t),e.children[n]=o}return e}function domToString(e,t){t=t||0;var n="";return e.html&&(n+="	".repeat(t),n+="TEXT"!==e.type?"<"+e.html+">":e.html),n&&(n+="\n"),e.children.length&&(n+=e.children.map(function(n){return domToString(n,t+(e.type?1:2))}).join("\n")),e.type&&"TEXT"!==e.type&&!e.selfClosing&&(n+="	".repeat(t),n+="</"+e.type+">\n"),n}function evaluate(models,path){for(var mi=0,model=void 0;mi<models.length&&void 0===model;){model=models[mi];try{with(model)model=eval(path)}catch(e){model=void 0,mi++}}return model}function copyNode(e){var t={parent:e.parent,html:e.html,type:e.type,selfClosing:e.selfClosing,repeat:e.repeat,children:e.children.map(copyNode)};return t}function repl(e,t){var n=/{([^{}|]+)}/g,r=e.match(n);if(!r)return e;for(;r.length;){var o=r[0];o=o.startsWith("{")?o.substr(1):o,o=o.endsWith("}")?o.substr(0,o.length-1):o;var i=evaluate(t,o);void 0!==i&&("function"==typeof i&&(i="Component.getComponent(this)."+o),e=e.replace(r[0],i)),r=r.slice(1)}return e}var r={tag:/<([^>]*?(?:(?:('|")[^'"]*?\2)[^>]*?)*)>/,repeat:/repeat=["|'].+["|']/,type:/[\s|/]*(.*?)[\s|\/|>]/,text:/(?:.|[\r\n])*?[^"'\\]</m};return{render:function(e){if("boolean"!=typeof e.html||e.html){var t=e.html,n=parse(t).root;n=renderRepeat(n,e),t=domToString(n,-1),e.element.innerHTML=t}}}};var CFWOptions=function(e){e=e||{},this.renderer=e.renderer||CFWRenderer(),this.componentProvider=e.componentProvider||function(e){var t=new Promise;CFW.loadingComponents[e]=t;var n="components/"+e+".js",r=document.createElement("script");return r.setAttribute("src",n),r.async=!1,r.onerror=function(e){t.reject("failed to load script '"+n+"'")},document.head.appendChild(r),t},this.htmlProvider=e.htmlProvider||function(e){var t=new Promise,n="components/"+e+".html",r=new XMLHttpRequest;return r.onreadystatechange=function(){if(4==r.readyState){var e=r.responseText;200==r.status?t.resolve(e):t.reject(e)}},r.open("GET",n,!0),r.send(),t}};window.CFW={components:[],loadingComponents:{},options:null,register:function(e){var t=new Promise;t.then(function(t){e.html=t,this.components.push(e),document.createElement(e.name),this.loadingComponents[e.name]&&this.loadingComponents[e.name].resolve()}.bind(this)),e.html?t.resolve(e.html):"boolean"!=typeof e.html||e.html?this.options.htmlProvider(e.name).then(t.resolve)["catch"](function(t){throw"No html template file found for Component "+e.name}):t.resolve(!1)},run:function(e){this.options=new CFWOptions(e),this.components.forEach(function(e){this.initComponent(e)}.bind(this))},initElement:function(e){this.components.forEach(function(t){this.initComponent(t,e)}.bind(this))},initComponent:function(e,t){t=t||document,Array.prototype.forEach.call(t.querySelectorAll(e.name),function(t){new Component(e,t)})},hasComponent:function(e){var t=this.components.filter(function(t){return t.name===e});return!!t.length},loadComponent:function(e){return this.options.componentProvider(e)}},window.require&&window.module&&window.module.exports&&(module.exports=CFW),window.Component=function(e,t){e=Component.normalize(e),t.component=this,this.element=t,this.orig_innerHTML=t.innerHTML;for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);this.properties.forEach(this.grabProperty.bind(this));var r;this.init&&(r=this.init.call(this));var o=this.requires.map(this.checkRequirement.bind(this));r instanceof Promise&&o.push(r),Promise.all(o).then(this.render.bind(this))["catch"](function(e){throw e})},Component.prototype.findOne=function(e){return this.element.querySelector(e)},Component.prototype.find=function(e){for(var t=this.element.querySelectorAll(e),n=[];t.length;)n.push(t[0]),t=t.slice(1);return n},Component.prototype.grabProperty=function(e){this[e]=this.element[e]||this.element.getAttribute(e)},Component.prototype.render=function(){CFW.options.renderer.render(this),this.updated&&this.updated(),this.initChildren(),CFW.initElement(this.element)},Component.prototype.checkRequirement=function(e){var t=new Promise;return window.CFW.hasComponent(e)?t.resolve():window.CFW.loadComponent(e).then(t.resolve)["catch"](t.reject),t},Component.prototype.initChildren=function(){for(var e=this.element.querySelectorAll("*"),t=0;t<e.length;t++){var n=e[t];n.id&&(this.children[n.id]=n),this.children[n.tagName]=this.children[n.tagName]||[],this.children[n.tagName].push(n)}},Component.prototype.getParent=function(){for(var e=this.element.parentNode;!e.component;)e=e.parentNode;return e.component},Component.getComponent=function(e){for(;!e.component;)e=e.parentNode;return e.component},Component.normalize=function(e){if(!e.name)throw"Component needs a name";return e.properties=e.properties||[],e.requires=e.requires||[],e.children={},e}}();