var ho;!function(t){var e;!function(t){var e=function(){function t(){}return t.prototype.getHTML=function(t){return new Promise(function(e,n){var o="components/"+t+".html",r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState){var t=r.responseText;200==r.status?e(t):n(t)}},r.open("GET",o,!0),r.send()})},t}();t.HtmlProvider=e}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function e(){}return e.prototype.getComponent=function(e){return new Promise(function(n,o){var r="components/"+e+".js",i=document.createElement("script");i.onload=function(){t.Component.register(window[e]),n()},i.src=r,document.getElementsByTagName("head")[0].appendChild(i)})},e}();t.ComponentProvider=e}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(ho){var components;!function(components){var Node=function(){function t(){this.children=[]}return t}(),Renderer=function(){function Renderer(){this.tmpCount=0,this.r={tag:/<([^>]*?(?:(?:('|")[^'"]*?\2)[^>]*?)*)>/,repeat:/repeat=["|'].+["|']/,type:/[\s|/]*(.*?)[\s|\/|>]/,text:/(?:.|[\r\n])*?[^"'\\]</m},this.cache={}}return Renderer.prototype.render=function(t){if("boolean"!=typeof t.html||t.html){var e=components.Component.getName(t),n=this.cache[e]=this.cache[e]||this.parse(t.html).root;n=this.renderRepeat(this.copyNode(n),t);var o=this.domToString(n,-1);t.element.innerHTML=o}},Renderer.prototype.parse=function(t,e){void 0===e&&(e=new Node);for(var n;null!==(n=this.r.tag.exec(t));){var o,r,i,s,h,p;if(0!==n.index?(o=t.match(this.r.text)[0],o=o.substr(0,o.length-1),r="TEXT",s=!0,h=!1):(o=n[1].trim(),r=(o+">").match(this.r.type)[1],i="/"===o[0],s="/"===o[o.length-1],h=!!o.match(this.r.repeat),s&&components.Component.registry.hasComponent(r)&&(s=!1,o=o.substr(0,o.length-1)+" ",p=!0)),t=t.slice(o.length+("TEXT"===r?0:2)),i)break;if(e.children.push({parent:e,html:o,type:r,selfClosing:s,repeat:h,children:[]}),!p&&!s){var c=this.parse(t,e.children[e.children.length-1]);t=c.html,e.children.pop(),e.children.push(c.root)}n=t.match(this.r.tag)}return{root:e,html:t}},Renderer.prototype.renderRepeat=function(t,e){e=[].concat(e);for(var n=0;n<t.children.length;n++){var o=t.children[n];if(o.repeat){var r,i=/repeat=["|']\s*(\S+)\s+as\s+(\S+?)["|']/,s=o.html.match(i).slice(1),h=s[1];if(h.indexOf(",")>-1){var p=h.split(",");h=p[0].trim(),r=p[1].trim()}var c=this.evaluate(e,s[0]),a=[];c.forEach(function(t,n){var i={};i[h]=t,i[r]=n;var s=[].concat(e);s.unshift(i);var p=this.copyNode(o);p.repeat=!1,p.html=p.html.replace(this.r.repeat,""),p.html=this.repl(p.html,s),p=this.renderRepeat(p,s),a.push(p)}.bind(this)),a.forEach(function(e){t.children.splice(t.children.indexOf(o),0,e)}),t.children.splice(t.children.indexOf(o),1)}else o.html=this.repl(o.html,e),o=this.renderRepeat(o,e),t.children[n]=o}return t},Renderer.prototype.domToString=function(t,e){e=e||0;var n="",o="	";return t.html&&(n+=o.repeat(e),n+="TEXT"!==t.type?"<"+t.html+">":t.html),n&&(n+="\n"),t.children.length&&(n+=t.children.map(function(n){return this.domToString(n,e+(t.type?1:2))}.bind(this)).join("\n")),t.type&&"TEXT"!==t.type&&!t.selfClosing&&(n+=o.repeat(e),n+="</"+t.type+">\n"),n},Renderer.prototype.evaluate=function(t,e){return"{"===e[0]&&"}"===e[--e.length]?this.evaluateExpression(t,e.substr(1,e.length-2)):"#"===e[0]?this.evaluateFunction(t,e.substr(1)):this.evaluateValue(t,e)},Renderer.prototype.evaluateValue=function(t,e){-1==t.indexOf(window)&&t.push(window);for(var n=0,o=void 0;n<t.length&&void 0===o;){o=t[n];try{o=new Function("model","return model['"+e.split(".").join("']['")+"']")(o)}catch(r){o=void 0}finally{n++}}return o},Renderer.prototype.evaluateExpression=function(models,path){-1==models.indexOf(window)&&models.push(window);for(var mi=0,model=void 0;mi<models.length&&void 0===model;){model=models[mi];try{with(model)model=eval(path)}catch(e){model=void 0}finally{mi++}}return model},Renderer.prototype.evaluateFunction=function(t,e){var n=e.split("("),o=n[0],r=n[1];o=this.evaluateValue(t,o),r=r.substr(0,r.length-2),r=r.split["."]&&r.split["."].map(this.evaluateExpression.bind(this,t)),window.F=window.F||{},window.F[this.tmpCount]=function(){o.apply(this,r)};var i="F["+this.tmpCount+"]()";return this.tmpCount++,i},Renderer.prototype.copyNode=function(t){var e=this.copyNode.bind(this),n={parent:t.parent,html:t.html,type:t.type,selfClosing:t.selfClosing,repeat:t.repeat,children:t.children.map(e)};return n},Renderer.prototype.repl=function(t,e){var n=/{(.+?)}}?/g,o=t.match(n);if(!o)return t;for(;o.length;){var r=o[0];r=r.substr(1,r.length-2);var i=this.evaluate(e,r);void 0!==i&&("function"==typeof i&&(i="ho.components.Component.getComponent(this)."+r),t=t.replace(o[0],i)),o=o.slice(1)}return t},Renderer}();components.Renderer=Renderer}(components=ho.components||(ho.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function e(e){var n=this;if(this.htmlProvider=new t.HtmlProvider,this.componentProvider=new t.ComponentProvider,this.renderer=new t.Renderer,e){var o=["htmlProvider","componentProvider","renderer"];o.forEach(function(t){e.hasOwnAttribute(t)&&(n[t]=e[t])})}}return e}();t.RegistryOptions=e}(e=t.components||(t.components={}))}(ho||(ho={}));var ho;!function(t){var e;!function(t){var e=function(){function e(e){this.components=[],this.htmlMap={},this.options=new t.RegistryOptions(e)}return e.prototype.setOptions=function(e){this.options=new t.RegistryOptions(e)},e.prototype.register=function(e){this.components.push(e),document.createElement(t.Component.getName(e))},e.prototype.run=function(){var t=this;this.components.forEach(function(e){t.initComponent(e)})},e.prototype.initComponent=function(e,n){void 0===n&&(n=document),Array.prototype.forEach.call(n.querySelectorAll(t.Component.getName(e)),function(t){new e(t)._init()})},e.prototype.initElement=function(t){var e=this;this.components.forEach(function(n){e.initComponent(n,t)})},e.prototype.hasComponent=function(e){return this.components.filter(function(n){return t.Component.getName(n)===e}).length>0},e.prototype.loadComponent=function(t){return this.options.componentProvider.getComponent(t)},e.prototype.getHtml=function(t){var e=new Promise;return void 0!==this.htmlMap[t]?e.resolve(this.htmlMap[t]):this.options.htmlProvider.getHTML(t).then(function(t){e.resolve(t)}),e},e.prototype.render=function(t){this.options.renderer.render(t)},e}();t.Registry=e}(e=t.components||(t.components={}))}(ho||(ho={}));var Promise=ho.promise.Promise,ho;!function(t){var e;!function(t){var e=function(){function e(t){this.properties=[],this.property={},this.requires=[],this.children={},this.element=t,this.element.component=this,this.original_innerHTML=t.innerHTML}return e.prototype.getParent=function(){return e.getComponent(this.element.parentNode)},e.prototype._init=function(){var t=this.render.bind(this);this.initProperties();var e=[this.initHTML(),Promise.create(this.init()),this.loadRequirements()];Promise.all(e).then(function(){t()})["catch"](function(t){throw t})},e.prototype.init=function(){},e.prototype.update=function(){return void 0},e.prototype.render=function(){e.registry.render(this),this.update(),this.initChildren(),e.registry.initElement(this.element)},e.prototype.initHTML=function(){var t=new Promise,n=this;if("boolean"==typeof this.html&&t.resolve(),"string"==typeof this.html&&t.resolve(),"undefined"==typeof this.html){var o=e.getName(this);e.registry.getHtml(o).then(function(e){n.html=e,t.resolve()})["catch"](t.reject)}return t},e.prototype.initProperties=function(){this.properties.forEach(function(t){if("object"==typeof t){if(this.properties[t.name]=this.element[t.name]||this.element.getAttribute(t.name)||t["default"],void 0===this.properties[t.name]&&t.required===!0)throw"Property "+t.name+" is required but not provided"}else"string"==typeof t&&(this.properties[t]=this.element[t]||this.element.getAttribute(t))}.bind(this))},e.prototype.initChildren=function(){for(var t=this.element.querySelectorAll("*"),e=0;e<t.length;e++){var n=t[e];n.id&&(this.children[n.id]=n),this.children[n.tagName]=this.children[n.tagName]||[],this.children[n.tagName].push(n)}},e.prototype.loadRequirements=function(){var t=this.requires.filter(function(t){return!e.registry.hasComponent(t)}).map(function(t){return e.registry.loadComponent(t)});return Promise.all(t)},e.register=function(t){e.registry.register(t)},e.run=function(t){e.registry.setOptions(t),e.registry.run()},e.getComponent=function(t){for(;!t.component;)t=t.parentNode;return t.component},e.getName=function(t){return t instanceof e?t.constructor.toString().match(/\w+/g)[1]:t.toString().match(/\w+/g)[1]},e.registry=new t.Registry,e}();t.Component=e}(e=t.components||(t.components={}))}(ho||(ho={}));